<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      padding: 4rem;
    }
    table {
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
    }
    th {
      background-color: #ddd;
      font-weight: bold;
      text-align: left;
    }
  </style>
  <script>
    function calculateDifference() {
      var date1 = new Date(document.getElementById('date1').value);
      var time1 = document.getElementById('time1').value.split(':');
      date1.setHours(parseInt(time1[0]), parseInt(time1[1]));

      var date2 = new Date(document.getElementById('date2').value);
      var time2 = document.getElementById('time2').value.split(':');
      date2.setHours(parseInt(time2[0]), parseInt(time2[1]));

      var difference = Math.abs(date2 - date1) / (1000 * 60 * 60);

      // Update daily results table
      var dailyTable = document.getElementById('daily-results');
      var newRow = dailyTable.insertRow(-1);
      var cell1 = newRow.insertCell(0);
      var cell2 = newRow.insertCell(1);
      var cell3 = newRow.insertCell(2);
      var cell4 = newRow.insertCell(3);

      var startTime = new Date(date1);
      var endTime = new Date(date2);
      cell1.innerHTML = date1.toLocaleDateString('fr-FR');
      cell2.innerHTML = time1.join(':');
      cell3.innerHTML = time2.join(':');
      cell4.innerHTML = difference.toFixed(2);

      // Update weekly results table
      var weeklyTable = document.getElementById('weekly-results');
      var currentWeekNumber = getWeekNumber(date1);
      var weekRow = weeklyTable.querySelector(`tr[data-week-number="${currentWeekNumber}"]`);

      if (!weekRow) {
        weekRow = weeklyTable.insertRow(-1);
        var weekCell1 = weekRow.insertCell(0);
        var weekCell2 = weekRow.insertCell(1);
        weekCell1.textContent = currentWeekNumber;
        weekCell2.textContent = difference.toFixed(2);
        weekRow.setAttribute('data-week-number', currentWeekNumber);
      } else {
        var totalHours = parseFloat(weekRow.cells[1].textContent) || 0;
        totalHours += difference;
        weekRow.cells[1].textContent = totalHours.toFixed(2);
      }

      // Sort tables by date
      sortTableByDate('daily-results');
      sortTableByDate('weekly-results');
    }

    function sortTableByDate(tableId) {
      var table = document.getElementById(tableId);
      var rows = Array.from(table.getElementsByTagName('tr')).slice(1); // Ignore header row
      var sortedRows = rows.sort(function(a, b) {
        var dateA = new Date(a.cells[0].textContent);
        var dateB = new Date(b.cells[0].textContent);
        return dateA - dateB;
      });
      sortedRows.forEach(function(row) {
        table.appendChild(row); // Append sorted rows to the table
      });
    }

    function getWeekNumber(date) {
      var d = new Date(date);
      d.setHours(0, 0, 0);
      d.setDate(d.getDate() + 4 - (d.getDay() || 7));
      var yearStart = new Date(d.getFullYear(), 0, 1);
      return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    }
  </script>
</head>
<body class="bg-gray-100">
  <div class="max-w-lg mx-auto bg-white p-8 border border-gray-300">
    <h1 class="text-2xl font-bold mb-4">Transports Lebranchu et fils</h1>
    <div class="mb-4">
      <label for="date1" class="font-bold">First Date:</label>
      <input type="date" id="date1" class="border border-gray-300 py-2 px-4">
      <input type="time" id="time1" class="border border-gray-300 py-2 px-4">
    </div>
    <div class="mb-4">
      <label for="date2" class="font-bold">Second Date:</label>
      <input type="date" id="date2" class="border border-gray-300 py-2 px-4">
      <input type="time" id="time2" class="border border-gray-300 py-2 px-4">
    </div>
    <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" onclick="calculateDifference()">Calculate</button>
    <h2 class="text-xl font-bold mt-4">Daily Results</h2>
    <table id="daily-results" class="mt-4">
      <tr>
        <th>Date</th>
        <th>Heure début</th>
        <th>Heures fin</th>
        <th>Heures travaillées</th>
      </tr>
    </table>
    <h2 class="text-xl font-bold mt-4">Weekly Results</h2>
    <table id="weekly-results" class="mt-4">
      <tr>
        <th>Semaine</th>
        <th>Total heures</th>
      </tr>
    </table>
  </div>
</body>
</html>
